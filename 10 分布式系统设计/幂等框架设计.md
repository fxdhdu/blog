[TOC]

幂等框架很少见，因为幂等性的保证是强业务相关的。（幂等号 + 工单互斥就是一个幂等框架 + 锁）

从使用的角度来说，幂等框架的主要处理流程是这样的。接口调用方生成幂等号，并且跟随接口请求，将幂等号传递给接口实现方。接口实现方接收到接口请求之后，按照约定，从 HTTP Header 或者接口参数中，解析出幂等号，然后通过幂等号查询幂等框架。如果幂等号已经存在，说明业务已经执行或正在执行，则直接返回；如果幂等号不存在，说明业务没有执行过，则记录幂等号，继续执行业务。

## 需求分析

- 功能性需求分析

- 非功能性需求分析：易用、易扩展、灵活、高性能、高容错



画线框图、写用户用例、基于测试驱动开发

## 设计

通过合理的设计，在实功能性需求的前提下，满足易用、易扩展、灵活、高性能、高容错等非功能性需求。

## 实现

利用设计思想、原则、模式、编码规范等，编写可读、可扩展等高质量的代码实现。



**接口返回的3种情况**

成功

失败

超时：执行结果未决



## 调用方接口超时如何处理

查询、删除（ABA问题）、更新（update x=y幂等，ABA问题；update x = x+delta非幂等）接口天然幂等

插入数据时，包含数据库唯一键

处理方式一：接口超时时，接口返回明确提示，让调用方决定是否超时。

处理方式二：调用其他接口来查询超时结果，基于明确结果来处理

处理方式三：调用方在接口超时时，直接重试，接口支持幂等。



幂等号：标识同一个业务请求，全局唯一

如何判定两次接口请求是同一个业务请求？（重试）

通过算法生成没有业务含义的幂等号



易用性：aop

性能

容错：降级









考虑的异常情况：

业务代码异常、业务系统宕机、幂等框架异常







