[TOC]



## 索引的基本概念

### 索引的定义

  索引（Index）是帮助MySQL高效获取数据的数据结构。

### 索引的作用

  减少遍历，提高Mysql的检索速度。查询算法只能应用于特定的数据结构上，数据库维护着满足特定查询算法的数据结构。

### 索引的缺点

  - 降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。
  - 索引文件会占用磁盘空间。

创建索引时，需要确保该索引是应用在 SQL 查询语句的条件(一般作为 WHERE 子句的条件)。
索引也是一张表，该表保存了主键与索引字段，并指向实体表的记录。

索引的实现和存储引擎相关，各存储引擎对索引支持各不相同。

## 索引分类

单列索引：一个索引只包含单个列，但一个表中可以有多个单列索引。

普通索引

唯一索引

主键索引：要求key是唯一的

组合索引：索引包含多个列



## 索引优化

通过覆盖索引，避免回表，减少树的搜索次数。但会增加索引字段维护开销。



## MySQL中的索引的存储类型（底层数据结构）：

BTREE：使用最多

B-Tree

B+Tree：提高区间访问的性能

HASH：

FULLTEXT：全文索引

RTREE

## 数据查询的类型

等值查询

范围查询（> < between）

模糊查询（like）

并集查询（or）

多值匹配（in）

## 最左前缀原则

- 在查询的where条件中，联合索引（包括退化的单列索引），在索引匹配时，只有存在最左前缀作为查询的条件时（从最左边开始的前缀），后面的索引才会生效。
- 范围查询时，只有第一列索引才生效。
- 最左前缀可以是联合索引的最左 N 个字段，也可以是字符串索引的最左 M 个字符。

索引匹配的最左原则具体是说，假如索引列分别为A，B，C，顺序也是A，B，C：

1. 那么查询的时候，如果查询【A】【A，B】 【A，B，C】，那么可以通过索引查询
2. 如果查询的时候，采用【A，C】，那么C这个虽然是索引，但是由于中间缺失了B，因此C这个索引是用不到的，只能用到A索引
3. 如果查询的时候，采用【B】 【B，C】 【C】，由于没有用到第一列索引，不是最左前缀，那么后面的索引也是用不到了
4. 如果查询的时候，采用范围查询，并且是最左前缀，也就是第一列索引，那么可以用到索引，但是范围后面的列无法用到索引



## 问题

### 什么时候表需要添加索引？

为了提高查询效率

### 索引加在哪些列上面？

- 查询条件下出现的列
- B+树索引添加在高选择性的列（名字）合适，低选择性（性别）的列不合适。
- 更新频繁的列不宜添加索引

### postgresql添加索引的sql语句怎么写？

- https://www.postgresql.org/docs/current/sql-createindex.html
- 当不指定索引方法时，默认为btree。其他包括哈希索引、全文索引等。

### 索引为什么能增加查询速度？

- 不添加索引时，索引失效时，会进行全表扫描
- 降低每次查找数据时，磁盘IO的数目，把磁盘IO的次数控制在一个很小的数量级。

### 索引什么时候生效、什么时候失效？

- 最左前缀原则
- 索引列包含在where查询条件中
- 在索引列上使用函数或进行运算也会使索引失效。可以将计算放到业务层。
- 负向条件不支持索引。!=、 <>、 not in、 not exist、 not like
- 索引最多用于一个范围列，范围列后的列索引失效

### 索引的实体是什么？数据结构是怎么样子的？

- 索引是数据结构。
- 不同引擎实现方式不同
- MyISAM，索引文件和数据文件分离(非聚集)，索引文件保存在磁盘上，仅仅保存数据记录的地址。
- InnoDB，叶子结点保存了完整的数据记录（聚集索引）。数据文件本身按主键聚集。

### 如何发现慢查询

### postgresql索引类型

- btree

  - 索引字段长度超过1/3索引页的大小，创建索引时会报错。
  - 支持哪些操作：= > < 等
  - B+树结构
  - High Key：B+树的每一个节点都有一个High-Key值，此值表示此节点或者此节点的子节点的最大值。

- hash索引

  hash索引存储的是被索引字段VALUE的哈希值，只支持**等值查询**。

  hash索引特别适用于**字段VALUE非常长**（不适合b-tree索引，因为b-tree一个PAGE至少要存储3个ENTRY，所以不支持特别长的VALUE）的场景，例如很长的字符串，并且用户只需要等值搜索，建议使用hash index。

![ScreenClip](.\assert\ScreenClip.png)

## 参考

http://blog.codinglabs.org/articles/theory-of-mysql-index.html

https://blog.csdn.net/xluren/article/details/32746183

[05 | 深入浅出索引（下）](https://time.geekbang.org/column/article/69636)